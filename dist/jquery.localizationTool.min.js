/*! Localization Tool - v0.0.5 - 2014-08-03
* http://darksmo.github.io/jquery-localization-tool/
* Copyright (c) 2014; Licensed MIT */
!function(a){var b={_languageCodeToOrdinal:function(b){var c=this,d=c.data("activeLanguageCodeArray"),e=d.indexOf(b);return-1===e&&a.error("Cannot convert "+b+" into an ordinal number"),e},_ordinalToLanguageCode:function(b){var c=this,d=c.data("activeLanguageCodeArray");return(d.length<=b||0>b)&&a.error("Cannot convert "+b+" into a language code."),d[b]},_languageCodeToHtml:function(a){var b=this,c=b.data("settings").languages,d=c[a],e="";d.flag.hasOwnProperty("class")&&(e=" "+d.flag["class"]);var f="";d.flag.hasOwnProperty("url")&&(f='<img src="'+d.flag.url+'" />');var g=d.language,h=d.country;return['<li class="ltool-language ',a,'">','<div class="ltool-language-flag',e,'"></div>',f,'<span class="ltool-language-country">',h,"</span>",'<span class="ltool-language-name">',g,"</span>","</li>"].join("")},_selectLanguage:function(b){var c=this;c.find(".ltool-dropdown-label").html(a(".ltool-language."+b).html()),c.data("selectedLanguageCode",b)},_initializeWidget:function(c){var d=this,e=d.data("settings"),f=e.languages,g=[];g.push('<span tabindex="0" class="ltool-dropdown-label">Change Language</span><div class="ltool-dropdown-label-arrow"></div>'),g.push('<ul class="ltool-dropdown-items">');var h,i;for(i=0;h=c[i++];)f.hasOwnProperty(h)?g.push(b._languageCodeToHtml.call(d,h)):a.error("The language '"+h+"' must be defined");return g.push("</ul>"),a(g.join("")).appendTo(d),d},_onDropdownClicked:function(){var a=this,b=a.data("selectedLanguageCode");return a.find(".ltool-language").removeClass("ltool-is-selected"),a.find("."+b).addClass("ltool-is-selected"),a.toggleClass("ltool-is-visible"),a},_closeDropdown:function(){var a=this;a.removeClass("ltool-is-visible")},_onMouseout:function(a){var b=this;return b.find(a.relatedTarget).length>0?(b.find(".ltool-is-selected").removeClass("ltool-is-selected"),a.preventDefault(),b):void b.removeClass("ltool-is-visible")},_onLanguageSelected:function(a){var c=this,d=a.attr("class").replace("ltool-language","").replace("ltool-is-selected","").replace(/ /g,"");b._selectLanguage.call(c,d),b.translate.call(c,d)},_selectPreviousLanguage:function(){var a=this,c=a.data("selectedLanguageCode"),d=b._languageCodeToOrdinal.call(a,c);if(0!==d){var e=b._ordinalToLanguageCode.call(a,d-1);return a.find(".ltool-is-selected").removeClass("ltool-is-selected"),b._selectLanguage.call(a,e),b.translate.call(a,e),a.find("."+e).addClass("ltool-is-selected"),a}},_selectNextLanguage:function(){var a=this,c=a.data("activeLanguageCodeArray"),d=a.data("selectedLanguageCode"),e=b._languageCodeToOrdinal.call(a,d);if(!(e+1>=c.length)){var f=b._ordinalToLanguageCode.call(a,e+1);return a.find(".ltool-is-selected").removeClass("ltool-is-selected"),b._selectLanguage.call(a,f),b.translate.call(a,f),a.find("."+f).addClass("ltool-is-selected"),a}},_onKeydown:function(a){var c=this;switch(a.keyCode){case 13:b._onDropdownClicked.call(c),a.preventDefault();break;case 40:b._selectNextLanguage.call(c),a.preventDefault();break;case 38:b._selectPreviousLanguage.call(c),a.preventDefault();break;case 27:b._closeDropdown.call(c),a.preventDefault()}return c},_bindEvents:function(){var c=this;return c.bind("click.localizationTool",function(a){b._onDropdownClicked.call(c,a)}).bind("keydown.localizationTool",function(a){b._onKeydown.call(c,a)}).bind("mouseout.localizationTool",function(a){b._onMouseout.call(c,a)}).bind("focusout.localizationTool",function(){b._closeDropdown.call(c)}),c.find(".ltool-language").bind("click.localizationTool",function(){b._onLanguageSelected.call(c,a(this))}),c},_decomposeStringsForReferenceMapping:function(){var a,b={idStrings:[],classStrings:[],elementStrings:[],textStrings:[]},c=this,d=c.data("settings").strings;for(a in d)d.hasOwnProperty(a)&&(0===a.indexOf("id:")?b.idStrings.push(a):0===a.indexOf("class:")?b.classStrings.push(a):0===a.indexOf("element:")?b.elementStrings.push(a):b.textStrings.push(a));return b},_buildStringReferenceMapping:function(){var c,d,e=this,f={},g=e.data("settings").strings,h=b._decomposeStringsForReferenceMapping.call(e);for(d=0;c=h.idStrings[d++];){var i=c.substring("id:".length),j=a("#"+i),k=j.contents();0===k.length||k.length>1?a.error(c+" must contain exactly one text node, found "+k.length+" instead"):3!==k[0].nodeType?a.error(c+" does not contain a #text node (i.e., type 3)"):f[c]={originalText:j.text(),domNodes:[j]}}var l=function(b,c,e,i){var j,k=b.replace(":","");for(d=0;j=h[k+"Strings"][d++];){var l,m,n=j.substring(b.length),o=[],p=!0,q=0;a:for(;m=a(c+n)[q++];){var r=a(m);if(e){var s=r.attr("id");if("string"==typeof s&&g.hasOwnProperty("id:"+s))continue a}if(i){var t=r.attr("class");if("string"==typeof t)for(var u,v=t.split(" "),w=0;u=v[w++];)if("string"==typeof u&&g.hasOwnProperty("class:"+u))continue a}var x=r.contents();0===x.length||x.length>1?a.error("A '"+j+"' node was found to contain "+x.length+" child nodes. This node must contain exactly one text node!"):3===x[0].nodeType?(o.push(r),"undefined"==typeof l?l=r.text():l!==r.text()&&(p=!1)):a.error("A '"+j+"' node does not contain a #text node (i.e., type 3)")}p?f[j]={originalText:l,domNodes:o}:a.error("Not all text content of elements with "+j+" were found to be '"+l+"'. So these elements will be ignored.")}};l("class:",".",!0,!1),l("element:","",!0,!0);var m;for(d=0;m=h.textStrings[d++];){var n,o,p=[],q=a(":contains("+m+")");for(n=0;o=q[n++];){var r=a(o).contents();1===r.length&&3===r[0].nodeType&&p.push(a(o))}p.length>0&&(f[m]={originalText:m,domNodes:p})}return e.data("refMappingObj",f),e},getSelectedLanguageCode:function(){var a=this;return a.data("selectedLanguageCode")},translate:function(b){var c=this,d=c.data("settings"),e=d.strings,f=c.data("refMappingObj"),g="ltr";if("undefined"!=typeof b){if(!d.languages.hasOwnProperty(b))return a.error("The language code "+b+" is not defined"),c;d.languages[b].hasOwnProperty("cssDirection")&&(g=d.languages[b].cssDirection)}var h;for(h in f)if(f.hasOwnProperty(h)){var i;i="undefined"==typeof b||b===d.defaultLanguage?f[h].originalText:e[h][b];var j,k,l=f[h].domNodes;for(k=0;j=l[k++];)j.html(i),j.css("direction",g)}return c},destroy:function(){var c=this;return c.removeData(),c.unbind("click.localizationTool",function(a){b._onDropdownClicked.call(c,a)}),c.find(".ltool-language").unbind("click.localizationTool",function(){b._onLanguageSelected.call(c,a(this))}),c.unbind("mouseout.localizationTool",function(a){b._onMouseout.call(c,a)}),c.empty(),c},_findSubsetOfUsedLanguages:function(a){var b,c=this,d=c.data("settings"),e={},f=0;for(b in a)if(a.hasOwnProperty(b)){var g,h=a[b];for(g in h)h.hasOwnProperty(g)&&(e.hasOwnProperty(g)||(e[g]=0)),e[g]++;f++}var i,j=[];for(i in e)e.hasOwnProperty(i)&&e[i]===f&&j.push(i);return j.unshift(d.defaultLanguage),j.sort(function(a,b){return d.languages[a].country.localeCompare(d.languages[b].country)}),j},init:function(c){var d={en_GB:{country:"United Kingdom",language:"English",countryTranslated:"United Kingdom",languageTranslated:"English",flag:{"class":"flag flag-gb"}},de_DE:{country:"Germany",language:"German",countryTranslated:"Deutschland",languageTranslated:"Deutsch",flag:{"class":"flag flag-de"}},es_ES:{country:"Spain",language:"Spanish",countryTranslated:"España",languageTranslated:"Español",flag:{"class":"flag flag-es"}},fr_FR:{country:"France",language:"French",countryTranslated:"France",languageTranslated:"Français",flag:{"class":"flag flag-fr"}},br_PT:{country:"Brazil",language:"Portuguese",countryTranslated:"Brasil",languageTranslated:"Português",flag:{"class":"flag flag-br"}},en_AU:{country:"Australia",language:"English",countryTranslated:"Australia",languageTranslated:"English",flag:{"class":"flag flag-au"}},en_IN:{country:"India",language:"English",countryTranslated:"India",languageTranslated:"Indian",flag:{"class":"flag flag-in"}},it_IT:{country:"Italy",language:"Italian",countryTranslated:"Italia",languageTranslated:"Italiano",flag:{"class":"flag flag-it"}},jp_JP:{country:"Japan",language:"Japanese",countryTranslated:"日本",languageTranslated:"日本語",flag:{"class":"flag flag-jp"}},ar_TN:{country:"Tunisia",language:"Arabic",countryTranslated:"تونس",languageTranslated:"عربي",cssDirection:"rtl",flag:{"class":"flag flag-tn"}},en_IE:{country:"Ireland",language:"English",countryTranslated:"Ireland",languageTranslated:"English",flag:{"class":"flag flag-ie"}},nl_NL:{country:"Netherlands",language:"Dutch",countryTranslated:"Nederland",languageTranslated:"Nederlands",flag:{"class":"flag flag-nl"}},zh_CN:{country:"China",language:"Chinese",countryTranslated:"中国",languageTranslated:"中文",flag:{"class":"flag flag-cn"}},fi_FI:{country:"Finland",language:"Finnish",countryTranslated:"Suomi",languageTranslated:"Suomi",flag:{"class":"flag flag-fi"}},pt_PT:{country:"Portugal",language:"Portuguese",countryTranslated:"Portugal",languageTranslated:"Português",flag:{"class":"flag flag-pt"}},pl_PL:{country:"Poland",language:"Polish",countryTranslated:"Polska",languageTranslated:"Polski",flag:{"class":"flag flag-pl"}},"ru-RU":{country:"Russia",language:"Russian",languageTranslated:"Русский",countryTranslated:"Россия",flag:{"class":"flag flag-ru"}}},e=a.extend({defaultLanguage:"en_GB",languages:{},strings:{}},c);return e.languages=a.extend(d,e.languages),e.languages.hasOwnProperty(e.defaultLanguage)||a.error("FATAL: the default language "+e.defaultLanguage+" is not defined in the 'languages' parameter!"),this.each(function(){var c=a(this);c.data("settings",e);var d=b._findSubsetOfUsedLanguages.call(c,e.strings);c.data("activeLanguageCodeArray",d),b._initializeWidget.call(c,d),b._selectLanguage.call(c,e.defaultLanguage),b._bindEvents.call(c),b._buildStringReferenceMapping.call(c)})}},c="localizationTool";a.fn[c]=function(d){if(b[d]){if(this.data("initialized")===!0)return b[d].apply(this,Array.prototype.slice.call(arguments,1));throw new Error("method "+d+" called on an uninitialized instance of "+c)}return"object"!=typeof d&&d?void a.error("Cannot call method "+d):(this.data("initialized",!0),b.init.apply(this,arguments))}}(jQuery);